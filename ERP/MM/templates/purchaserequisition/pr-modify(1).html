<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">

    <title>DASHGUM - Bootstrap Admin Template</title>

    {% load static %}
    <link rel="stylesheet" href="{% static 'assets/css/style-qr.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/notice.min.css' %}">
    <link rel="stylesheet"
          href="{% static 'assets/css/default.min.css' %}">

    <!-- Bootstrap core CSS -->
    <link href="{% static 'assets/css/bootstrap.css' %}" rel="stylesheet">
    <!--external css-->
    <link href="{% static 'assets/font-awesome/css/font-awesome.css' %}" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="{% static 'assets/js/bootstrap-datepicker/css/datepicker.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'assets/js/bootstrap-daterangepicker/daterangepicker.css' %}" />
        
    <!-- Custom styles for this template -->
    <link href="{% static 'assets/css/style.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/style-responsive.css' %}" rel="stylesheet">

    <link href="{% static 'assets/css/purchase.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/the-datepicker.css' %}" rel="stylesheet">



  </head>

  <body>

    <section id="container" >
        <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
        <!--header start-->
        <header class="header black-bg">
          <div class="sidebar-toggle-box">
              <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
          </div>
        <!--logo start-->
        <a href="index.html" class="logo"><b>MD集团物料管理系统</b></a>
        <!--logo end-->
        <div class="nav notify-row" id="top_menu">
            <!--  notification start -->
        
    </header>
  <!--header end-->
  
  <!-- **********************************************************************************************************************************************************
  MAIN SIDEBAR MENU
  *********************************************************************************************************************************************************** -->
  <!--sidebar start-->
  <aside>
      <div id="sidebar"  class="nav-collapse ">
          <!-- sidebar menu start-->
          <ul class="sidebar-menu" id="nav-accordion">
                  
              <p class="centered"><img src="/static/assets/img/ui-sam.jpg" class="img-circle" width="60"></a></p>
              <h5 class="centered">物料管理</h5>
                  
            <li class="mt">
                <a href="/mm/home/">
                    <i class="fa fa-dashboard"></i>
                    <span>主页</span>
                </a>
            </li>
  
            <li class="sub-menu">
                <a href="javascript:;" >
                    <i class="fa fa-desktop"></i>
                    <span>供应商管理</span>
                </a>
                <ul class="sub">
                    <li><a  href="/mm/vendor/create/">创建新供应商</a></li>
                    <li><a  href="/mm/vendor/search/">查看或修改供应商信息</a></li>
                    <li><a  href="/mm/vendor/history/">供应商交易历史汇总</a></li>
                </ul>
            </li>
  
            <li class="sub-menu">
                <a href="javascript:;" >
                    <i class="fa fa-cogs"></i>
                    <span>商品管理</span>
                </a>
                <ul class="sub">
                    <li><a  href="/mm/material/item/create/">创建新商品</a></li>
                    <li><a  href="/mm/material/search/">查看或修改商品信息</a></li>
                    <li><a  href="/mm/material/item/stock/">查看商品库存</a></li>
                </ul>
            </li>
            
            <li class="sub-menu">
                    <a href="javascript:;" >
                        <i class="fa fa-th"></i>
                        <span>采购订单管理</span>
                    </a>
                    <ul class="sub">
                        <li><a  href="/mm/purchaserequisition/prmanage">采购申请</a ></li>
                            <li><a  href="/mm/purchaserequisition/quoma">供应商评估管理</a ></li>
                            <li><a  href="/mm/purchaserequisition/pomanage">采购订单</a ></li>
        
                    </ul>
                </li>
                
                <li class="sub-menu">
                    <a href="javascript:;" >
                        <i class="fa fa-tasks"></i>
                        <span>收货管理</span>
                    </a>
                    <ul class="sub">
                        <li ><a  href="/mm/receipt/orders/search/">创建商品收据</a></li>
                        <li ><a  href="/mm/receipt/search/">查看商品收据</a></li>
                        <li ><a  href="/mm/invoice/orders/search/">创建发票收据</a></li>
                        <li ><a  href="/mm/invoice/search/">查看发票收据</a></li>
                        <li ><a  href="/mm/invoice/payment/">付款</a></li>
                    </ul>
                </li>
            
  
        </ul>
          
          <!-- sidebar menu end-->
      </div>
  </aside>
  </section> 
      
      <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
          	<h3><i class="fa fa-angle-right"></i> 修改采购申请</h3>
          	
          	<!-- BASIC FORM ELELEMNTS -->
          	<div class="row mt">
                <div class="col-lg-12">
                <div class="form-panel">
                      <h4 class="mb"><i class="fa fa-angle-right"></i> 基本信息</h4>

                      {% for c in purchaseRequisition %}
                      <div class="form-group">
                          <label class="col-sm-2 col-sm-2 control-label">采购申请编码</label>
                          <div class="col-lg-10">
                              <p class="form-control-static" id="rid">{{c.id}}</p>
                          </div>
                      </div>
                      
                      <div class="form-group">
                          <label class="col-sm-2 col-sm-2 control-label">创建者编码</label>
                          <div class="col-lg-10">
                              <p class="form-control-static">{{c.euser_id}}</p>
                          </div>
                      </div>
                      <div class="form-group">
                          <label class="col-sm-2 col-sm-2 control-label">创建时间</label>
                          <div class="col-lg-10">
                              <p class="form-control-static">{{c.time}}</p>
                          </div>
                      </div>


                                            <div class="form-group">
                          <label class="col-sm-2 col-sm-2 control-label">备注</label>
                          <div class="col-sm-10">
                              <input rows="3" name="beizhu" type="text" class="form-control" value="{{c.text}}" id="beizhu"></input>
                          </div>
                      </div>
                      {%endfor%}
                      <div class="form-group">
                      <div class="col-md-12 mt">
                          <div class="content-panel">
                              <table class="table table-hover">
                               <div id="table-pr-head"> <h4><i class="fa fa-angle-right"></i> 商品信息</h4>

                              </div>
                                  <thead>
                                  <tr>
                                      <th>#&nbsp 条目编码</th>
                                      <th>商品编码</th>
                                      <th>商品名称</th>
                                      <th>估价</th>
                                      <th>货币单位</th>
                                      <th>数量</th>
                                      <th>送货时间</th>
                                      <th>工厂</th>
                                      <th>存储位置</th>
                                      <th>状态</th>
                                      <th></th>
                                  </tr>
                                  </thead>
                                  <tbody id="gooddiv">
                                      {% for c in reuqe %}
                                      <tr>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.itemId}}" ></td>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.meterial__id}}" ></td>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.meterial__material__mname}}"></td>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.estimatedPrice}}"></td>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.currency}}"></td>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.quantity}}"></td>
                                          <td class="td-text" style="width:110px"> <input type="text" class="form-control td-text-modify"  value="{{c.deliveryDate.day}}. {{c.deliveryDate.month}}. {{c.deliveryDate.year}}"onclick="date(this)"></td>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.meterial__material__mname}}"></td>
                                          <td class="td-text"> <input type="text" class="form-control td-text-modify" value="{{c.meterial__sloc}}"></td>
                                          <td class="td-text" id="state">{{c.status}}</td>
                                          <td>
                                              <button  class="btn btn-link" onclick="save(this)">保存</button> <!--不同状态保存成功失败的判断-->
                                          </td>
                                      </tr>
                                      {%endfor%}
                              </tbody>
                              </table>

          </div><! --/content-panel -->

          </div><!-- /col-md-12 -->
      </div>
      <div id="btn-pr-create">
          <button type="submit" class="btn btn-primary btn-lg btn-block" onclick="savepr()" >保存采购申请</button>
      </div>


                </div>
                </div><!-- col-lg-12-->
            </div><!-- /row -->





		</section><! --/wrapper -->

      </section><!-- /MAIN CONTENT -->

      <!--main content end-->
      <!--footer start-->
     
      <!--footer end-->
  </section>

 <!-- js placed at the end of the document so the pages load faster -->
    <script src="{% static 'assets/js/jquery.js' %}"></script>
    <script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
    <script class="include" type="text/javascript" src="{% static 'assets/js/jquery.dcjqaccordion.2.7.js' %}"></script>
    <script src="{% static 'assets/js/jquery.scrollTo.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery.nicescroll.js' %}" type="text/javascript"></script>
    <!--common script for all pages-->
    <script src="{% static 'assets/js/common-scripts.js' %}"></script>

    <!--script for this page-->
    <script src="{% static 'assets/js/jquery-ui-1.9.2.custom.min.js' %}"></script>

	<!--custom switch-->
	<script src="{% static 'assets/js/bootstrap-switch.js' %}"></script>

	<!--custom tagsinput-->
	<script src="{% static 'assets/js/jquery.tagsinput.js' %}"></script>

	<!--custom checkbox & radio-->

	<script src="{% static 'assets/js/form-component.js' %}"></script>

    <script src="{% static 'assets/js/highlight.min.js' %}"></script>
    <script>
        hljs.highlightAll();
    </script>

    <script src="{% static 'assets/js/notice.min.js' %}"></script>
    <script>
        const notice = new Notice();
    </script>

    <script src="{% static 'assets/js/main-qr.js' %}"></script>

        <script src="{% static 'assets/js/the-datepicker.js' %}"></script>

        <script>
            function date(time){
            var datepicker = new TheDatepicker.Datepicker(time);
            datepicker.render();
            }
    </script>

<script>
   /* confirmo.init({
        yesBg: 'red',
        noBg: 'green'
    });
     function hello() {
        alert('修改成功');
    }
    */
    function save(nowTr){ //保存
        //保存失败
         var $td=$(nowTr).parent().parent();
         var state=$td.find("#state").text();
         if($.trim(state) == "已创建采购订单")
         showMessage({text: '已创建采购订单，无法修改。',type: 'warning'})
         else  {
        var rid=document.getElementById("rid").innerHTML
        var itemId = $(nowTr).parent().parent().children().eq(0).children().val();
        var mid = $(nowTr).parent().parent().children().eq(1).children().val();
        var mname = $(nowTr).parent().parent().children().eq(2).children().val();
        var estimatedPrice = $(nowTr).parent().parent().children().eq(3).children().val();
        var currency = $(nowTr).parent().parent().children().eq(4).children().val();
        var quantity = $(nowTr).parent().parent().children().eq(5).children().val();
        var deliveryDate = $(nowTr).parent().parent().children().eq(6).children().val();
        var plant = $(nowTr).parent().parent().children().eq(7).children().val();
        var sloc = $(nowTr).parent().parent().children().eq(8).children().val();
        var $td=$(nowTr).parent().parent();
        var state=$td.find("#state").text();
        console.log(rid,itemId,mid,mname,estimatedPrice,currency,quantity,deliveryDate,plant,sloc)
        $.ajax({
            type: 'post',
            url: '/mm/purchaserequisition/getmodifyinfo2/',
            data:{
              "rid": rid,
              "itemId": itemId,
              "meterial__id": mid,
              "mname": mname,
              "estimatedPrice": estimatedPrice,
              "currency": currency,
              "quantity": quantity,
              "deliveryDate": deliveryDate,
              "meterial__material__mname": plant,
              "meterial__sloc": sloc
          },
            success: function (data) {
                showMessage({text: '修改成功！',type: 'success'})  //成功

         }
      })

    }
    }

    function savepr(){ //保存备注
        var rid=document.getElementById("rid").innerHTML
        var beizhu=$("#beizhu").val()
        console.log(rid,beizhu)
        $.ajax({
            type: 'post',
            url: '',
            data:{
              "rid": rid,
              "beizhu" :beizhu
          },
            success: function (data) {
                showMessage({text: '保存采购申请成功！',type: 'success'})  //成功

         }
      })

    }


</script>

</body>
</html>